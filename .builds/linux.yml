image: archlinux
packages:
  - rsync
  - sdl2
  - sdl2_image
  - sdl2_mixer
  - wget
  - fuse2
sources:
  - https://git.sr.ht/~bentglasstube/power-of-hove
environment:
  target: 'power-of-hove-linux'
  deploy: 'build@build.eatabrick.org:power-of-hove'
secrets:
  - 7a7c0309-95bb-4107-9e42-96352295d661
tasks:
  - build: |
      wget "https://github.com/AppImage/AppImageKit/releases/download/12/appimagetool-x86_64.AppImage"
      chmod +x appimagetool-x86_64.AppImage
      sudo mv appimagetool-x86_64.AppImage /usr/local/bin/appimagetool
      cd power-of-hove
      make package
  - deploy: |
      cd power-of-hove
      version=$(git describe --tags)
      sshopts="ssh -o StrictHostKeyChecking=no"
      rsync --rsh="$sshopts" -rP bazel-bin/"$target".tar.gz "$deploy"/"$target"-"$version".tgz
